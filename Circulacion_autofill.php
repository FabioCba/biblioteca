<?php
// This script and data application were generated by AppGini 22.14
// Download AppGini for free from https://bigprof.com/appgini/download/

	include_once(__DIR__ . '/lib.php');

	handle_maintenance();

	header('Content-type: text/javascript; charset=' . datalist_db_encoding);

	$table_perms = getTablePermissions('Circulacion');
	if(!$table_perms['access']) die('// Access denied!');

	$mfk = Request::val('mfk');
	$id = makeSafe(Request::val('id'));
	$rnd1 = intval(Request::val('rnd1')); if(!$rnd1) $rnd1 = '';

	if(!$mfk) {
		die('// No js code available!');
	}

	switch($mfk) {

		case 'id_Usuario':
			if(!$id) {
				?>
				$j('#Foto_Usuario<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `Usuarios`.`id` as 'id', `Usuarios`.`Foto` as 'Foto', IF(    CHAR_LENGTH(`Tipo_Usuario1`.`Descripcion`), CONCAT_WS('',   `Tipo_Usuario1`.`Descripcion`), '') as 'id_Tipo_usuario', `Usuarios`.`Apellidos` as 'Apellidos', `Usuarios`.`Nombres` as 'Nombres', `Usuarios`.`Correo` as 'Correo', `Usuarios`.`Telefono` as 'Telefono', IF(    CHAR_LENGTH(`Estado_Suscripcion1`.`Descripcion`), CONCAT_WS('',   `Estado_Suscripcion1`.`Descripcion`), '') as 'id_Estado_suscripcion', if(`Usuarios`.`Fecha_Registro`,date_format(`Usuarios`.`Fecha_Registro`,'%m/%d/%Y'),'') as 'Fecha_Registro' FROM `Usuarios` LEFT JOIN `Tipo_Usuario` as Tipo_Usuario1 ON `Tipo_Usuario1`.`id`=`Usuarios`.`id_Tipo_usuario` LEFT JOIN `Estado_Suscripcion` as Estado_Suscripcion1 ON `Estado_Suscripcion1`.`id`=`Usuarios`.`id_Estado_suscripcion`  WHERE `Usuarios`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			<?php if($row['Foto']) { ?> 
				$j('#Foto_Usuario<?php echo $rnd1; ?>').html('<a href="<?php echo getUploadDir('') . addslashes(str_replace(["\r", "\n"], '', $row['Foto'])); ?>" data-lightbox="Circulacion_dv"><img src="thumbnail.php?i=<?php echo urlencode($row['Foto']); ?>&t=Usuarios&f=Foto&v=dv" class="img-thumbnail"></a>');
			<?php } else { ?>
				$j('#Foto_Usuario<?php echo $rnd1; ?>').html('<img src="thumbnail.php?i=&t=Usuarios&f=Foto&v=dv" class="img-thumbnail">');
			<?php } ?>
			<?php
			break;

		case 'Libro_Prestado':
			if(!$id) {
				?>
				$j('#id_Registro<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#Portada_libro<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#Ejemp_Disponibles<?php echo $rnd1; ?>').html('&nbsp;');
				$j('#Item<?php echo $rnd1; ?>').html('&nbsp;');
				<?php
				break;
			}
			$res = sql("SELECT `Catalogo`.`id` as 'id', `Catalogo`.`Portada` as 'Portada', IF(    CHAR_LENGTH(`Registros1`.`Codigo_de_Registro`), CONCAT_WS('',   `Registros1`.`Codigo_de_Registro`), '') as 'Codigo_Registro', IF(    CHAR_LENGTH(`Registros1`.`Codigo_Barras`), CONCAT_WS('',   `Registros1`.`Codigo_Barras`), '') as 'Cod_Barras', `Catalogo`.`Item` as 'Item', `Catalogo`.`Cod_Ejemplar` as 'Cod_Ejemplar', `Catalogo`.`Tipo_Literatura` as 'Tipo_Literatura', IF(    CHAR_LENGTH(`Tipo_Documento1`.`Descripcion`), CONCAT_WS('',   `Tipo_Documento1`.`Descripcion`), '') as 'Tipo_Documento', IF(    CHAR_LENGTH(`Estado_Catalogacion1`.`Descripcion`), CONCAT_WS('',   `Estado_Catalogacion1`.`Descripcion`), '') as 'id_Estado_Catalogacion', `Catalogo`.`Signatura_Topografica` as 'Signatura_Topografica', IF(    CHAR_LENGTH(`Autoridades1`.`Nombre`), CONCAT_WS('',   `Autoridades1`.`Nombre`), '') as 'Id_Autoridad', `Catalogo`.`Titulo` as 'Titulo', `Catalogo`.`Responsabilidades` as 'Responsabilidades', `Catalogo`.`Edicion` as 'Edicion', IF(    CHAR_LENGTH(`Lugares1`.`Descripcion`), CONCAT_WS('',   `Lugares1`.`Descripcion`), '') as 'Id_Lugar', IF(    CHAR_LENGTH(`Editoriales1`.`Nombre`), CONCAT_WS('',   `Editoriales1`.`Nombre`), '') as 'id_Editorial', `Catalogo`.`Fecha_Publicacion` as 'Fecha_Publicacion', `Catalogo`.`Desc_Fisica` as 'Desc_Fisica', `Catalogo`.`Notas` as 'Notas', IF(    CHAR_LENGTH(`Materias1`.`Descriptor`), CONCAT_WS('',   `Materias1`.`Descriptor`), '') as 'Materia_1', IF(    CHAR_LENGTH(`Materias2`.`Descriptor`), CONCAT_WS('',   `Materias2`.`Descriptor`), '') as 'Materia_2', IF(    CHAR_LENGTH(`Materias3`.`Descriptor`), CONCAT_WS('',   `Materias3`.`Descriptor`), '') as 'Materia_3', `Catalogo`.`Ejemplares` as 'Ejemplares', if(`Catalogo`.`Fecha_Catalogacion`,date_format(`Catalogo`.`Fecha_Catalogacion`,'%m/%d/%Y'),'') as 'Fecha_Catalogacion' FROM `Catalogo` LEFT JOIN `Registros` as Registros1 ON `Registros1`.`id`=`Catalogo`.`Codigo_Registro` LEFT JOIN `Tipo_Documento` as Tipo_Documento1 ON `Tipo_Documento1`.`id`=`Catalogo`.`Tipo_Documento` LEFT JOIN `Estado_Catalogacion` as Estado_Catalogacion1 ON `Estado_Catalogacion1`.`id`=`Catalogo`.`id_Estado_Catalogacion` LEFT JOIN `Autoridades` as Autoridades1 ON `Autoridades1`.`id`=`Catalogo`.`Id_Autoridad` LEFT JOIN `Lugares` as Lugares1 ON `Lugares1`.`id`=`Catalogo`.`Id_Lugar` LEFT JOIN `Editoriales` as Editoriales1 ON `Editoriales1`.`id`=`Catalogo`.`id_Editorial` LEFT JOIN `Materias` as Materias1 ON `Materias1`.`id`=`Catalogo`.`Materia_1` LEFT JOIN `Materias` as Materias2 ON `Materias2`.`id`=`Catalogo`.`Materia_2` LEFT JOIN `Materias` as Materias3 ON `Materias3`.`id`=`Catalogo`.`Materia_3`  WHERE `Catalogo`.`id`='{$id}' limit 1", $eo);
			$row = db_fetch_assoc($res);
			?>
			$j('#id_Registro<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['Codigo_Registro']))); ?>&nbsp;');
			<?php if($row['Portada']) { ?> 
				$j('#Portada_libro<?php echo $rnd1; ?>').html('<a href="<?php echo getUploadDir('') . addslashes(str_replace(["\r", "\n"], '', $row['Portada'])); ?>" data-lightbox="Circulacion_dv"><img src="thumbnail.php?i=<?php echo urlencode($row['Portada']); ?>&t=Catalogo&f=Portada&v=dv" class="img-thumbnail"></a>');
			<?php } else { ?>
				$j('#Portada_libro<?php echo $rnd1; ?>').html('<img src="thumbnail.php?i=&t=Catalogo&f=Portada&v=dv" class="img-thumbnail">');
			<?php } ?>
			$j('#Ejemp_Disponibles<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['Ejemplares']))); ?>&nbsp;');
			$j('#Item<?php echo $rnd1; ?>').html('<?php echo addslashes(str_replace(["\r", "\n"], '', safe_html($row['Item']))); ?>&nbsp;');
			<?php
			break;


	}

?>