<?php
// This script and data application were generated by AppGini 22.14
// Download AppGini for free from https://bigprof.com/appgini/download/

	/* Configuration */
	/*************************************/

		$pcConfig = [
			'Estado_Conservacion' => [
			],
			'Estado_Prestable' => [
			],
			'Registros' => [
			],
			'Estado_Prestamo' => [
			],
			'Estado_Catalogacion' => [
			],
			'Editoriales' => [
			],
			'Catalogo' => [
				'Codigo_Registro' => [
					'parent-table' => 'Registros',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Catalogo <span class="hidden child-label-Catalogo child-field-caption">(Codigo Registro)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/book_add.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => [1 => 'Portada', 2 => 'Codigo Registro', 3 => 'C&#243;digo de  Barras', 4 => 'Item', 5 => 'Cod Ejemplar', 6 => 'Tipo de Literatura', 7 => 'Tipo de Documento', 8 => 'Estado de Catalogacion', 9 => 'Signatura Topografica', 10 => 'Autor', 11 => 'Titulo', 12 => 'Responsabilidades', 13 => 'Edicion', 14 => 'Lugar de Publicaci&#243;n', 15 => 'Editorial', 16 => 'Fecha de Publicacion', 17 => 'Descripci&#243;n Fisica', 18 => 'Notas', 19 => 'Materia 1', 20 => 'Materia 2', 21 => 'Materia 3', 22 => 'Ejemplares', 23 => 'Fecha de Catalogaci&#243;n'],
					'display-field-names' => [1 => 'Portada', 2 => 'Codigo_Registro', 3 => 'Cod_Barras', 4 => 'Item', 5 => 'Cod_Ejemplar', 6 => 'Tipo_Literatura', 7 => 'Tipo_Documento', 8 => 'id_Estado_Catalogacion', 9 => 'Signatura_Topografica', 10 => 'Id_Autoridad', 11 => 'Titulo', 12 => 'Responsabilidades', 13 => 'Edicion', 14 => 'Id_Lugar', 15 => 'id_Editorial', 16 => 'Fecha_Publicacion', 17 => 'Desc_Fisica', 18 => 'Notas', 19 => 'Materia_1', 20 => 'Materia_2', 21 => 'Materia_3', 22 => 'Ejemplares', 23 => 'Fecha_Catalogacion'],
					'sortable-fields' => [0 => '`Catalogo`.`id`', 1 => 2, 2 => '`Registros1`.`Codigo_de_Registro`', 3 => '`Registros1`.`Codigo_Barras`', 4 => 5, 5 => 6, 6 => 7, 7 => '`Tipo_Documento1`.`Descripcion`', 8 => '`Estado_Catalogacion1`.`Descripcion`', 9 => 10, 10 => '`Autoridades1`.`Nombre`', 11 => 12, 12 => 13, 13 => 14, 14 => '`Lugares1`.`Descripcion`', 15 => '`Editoriales1`.`Nombre`', 16 => 17, 17 => 18, 18 => 19, 19 => '`Materias1`.`Descriptor`', 20 => '`Materias2`.`Descriptor`', 21 => '`Materias3`.`Descriptor`', 22 => '`Catalogo`.`Ejemplares`', 23 => '`Catalogo`.`Fecha_Catalogacion`'],
					'records-per-page' => 10,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-Catalogo',
					'template-printable' => 'children-Catalogo-printable',
					'query' => "SELECT `Catalogo`.`id` as 'id', `Catalogo`.`Portada` as 'Portada', IF(    CHAR_LENGTH(`Registros1`.`Codigo_de_Registro`), CONCAT_WS('',   `Registros1`.`Codigo_de_Registro`), '') as 'Codigo_Registro', IF(    CHAR_LENGTH(`Registros1`.`Codigo_Barras`), CONCAT_WS('',   `Registros1`.`Codigo_Barras`), '') as 'Cod_Barras', `Catalogo`.`Item` as 'Item', `Catalogo`.`Cod_Ejemplar` as 'Cod_Ejemplar', `Catalogo`.`Tipo_Literatura` as 'Tipo_Literatura', IF(    CHAR_LENGTH(`Tipo_Documento1`.`Descripcion`), CONCAT_WS('',   `Tipo_Documento1`.`Descripcion`), '') as 'Tipo_Documento', IF(    CHAR_LENGTH(`Estado_Catalogacion1`.`Descripcion`), CONCAT_WS('',   `Estado_Catalogacion1`.`Descripcion`), '') as 'id_Estado_Catalogacion', `Catalogo`.`Signatura_Topografica` as 'Signatura_Topografica', IF(    CHAR_LENGTH(`Autoridades1`.`Nombre`), CONCAT_WS('',   `Autoridades1`.`Nombre`), '') as 'Id_Autoridad', `Catalogo`.`Titulo` as 'Titulo', `Catalogo`.`Responsabilidades` as 'Responsabilidades', `Catalogo`.`Edicion` as 'Edicion', IF(    CHAR_LENGTH(`Lugares1`.`Descripcion`), CONCAT_WS('',   `Lugares1`.`Descripcion`), '') as 'Id_Lugar', IF(    CHAR_LENGTH(`Editoriales1`.`Nombre`), CONCAT_WS('',   `Editoriales1`.`Nombre`), '') as 'id_Editorial', `Catalogo`.`Fecha_Publicacion` as 'Fecha_Publicacion', `Catalogo`.`Desc_Fisica` as 'Desc_Fisica', `Catalogo`.`Notas` as 'Notas', IF(    CHAR_LENGTH(`Materias1`.`Descriptor`), CONCAT_WS('',   `Materias1`.`Descriptor`), '') as 'Materia_1', IF(    CHAR_LENGTH(`Materias2`.`Descriptor`), CONCAT_WS('',   `Materias2`.`Descriptor`), '') as 'Materia_2', IF(    CHAR_LENGTH(`Materias3`.`Descriptor`), CONCAT_WS('',   `Materias3`.`Descriptor`), '') as 'Materia_3', `Catalogo`.`Ejemplares` as 'Ejemplares', if(`Catalogo`.`Fecha_Catalogacion`,date_format(`Catalogo`.`Fecha_Catalogacion`,'%m/%d/%Y'),'') as 'Fecha_Catalogacion' FROM `Catalogo` LEFT JOIN `Registros` as Registros1 ON `Registros1`.`id`=`Catalogo`.`Codigo_Registro` LEFT JOIN `Tipo_Documento` as Tipo_Documento1 ON `Tipo_Documento1`.`id`=`Catalogo`.`Tipo_Documento` LEFT JOIN `Estado_Catalogacion` as Estado_Catalogacion1 ON `Estado_Catalogacion1`.`id`=`Catalogo`.`id_Estado_Catalogacion` LEFT JOIN `Autoridades` as Autoridades1 ON `Autoridades1`.`id`=`Catalogo`.`Id_Autoridad` LEFT JOIN `Lugares` as Lugares1 ON `Lugares1`.`id`=`Catalogo`.`Id_Lugar` LEFT JOIN `Editoriales` as Editoriales1 ON `Editoriales1`.`id`=`Catalogo`.`id_Editorial` LEFT JOIN `Materias` as Materias1 ON `Materias1`.`id`=`Catalogo`.`Materia_1` LEFT JOIN `Materias` as Materias2 ON `Materias2`.`id`=`Catalogo`.`Materia_2` LEFT JOIN `Materias` as Materias3 ON `Materias3`.`id`=`Catalogo`.`Materia_3` "
				],
				'Id_Autoridad' => [
					'parent-table' => 'Autoridades',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Catalogo <span class="hidden child-label-Catalogo child-field-caption">(Autor)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/book_add.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => [1 => 'Portada', 2 => 'Codigo Registro', 3 => 'C&#243;digo de  Barras', 4 => 'Item', 5 => 'Cod Ejemplar', 6 => 'Tipo de Literatura', 7 => 'Tipo de Documento', 8 => 'Estado de Catalogacion', 9 => 'Signatura Topografica', 10 => 'Autor', 11 => 'Titulo', 12 => 'Responsabilidades', 13 => 'Edicion', 14 => 'Lugar de Publicaci&#243;n', 15 => 'Editorial', 16 => 'Fecha de Publicacion', 17 => 'Descripci&#243;n Fisica', 18 => 'Notas', 19 => 'Materia 1', 20 => 'Materia 2', 21 => 'Materia 3', 22 => 'Ejemplares', 23 => 'Fecha de Catalogaci&#243;n'],
					'display-field-names' => [1 => 'Portada', 2 => 'Codigo_Registro', 3 => 'Cod_Barras', 4 => 'Item', 5 => 'Cod_Ejemplar', 6 => 'Tipo_Literatura', 7 => 'Tipo_Documento', 8 => 'id_Estado_Catalogacion', 9 => 'Signatura_Topografica', 10 => 'Id_Autoridad', 11 => 'Titulo', 12 => 'Responsabilidades', 13 => 'Edicion', 14 => 'Id_Lugar', 15 => 'id_Editorial', 16 => 'Fecha_Publicacion', 17 => 'Desc_Fisica', 18 => 'Notas', 19 => 'Materia_1', 20 => 'Materia_2', 21 => 'Materia_3', 22 => 'Ejemplares', 23 => 'Fecha_Catalogacion'],
					'sortable-fields' => [0 => '`Catalogo`.`id`', 1 => 2, 2 => '`Registros1`.`Codigo_de_Registro`', 3 => '`Registros1`.`Codigo_Barras`', 4 => 5, 5 => 6, 6 => 7, 7 => '`Tipo_Documento1`.`Descripcion`', 8 => '`Estado_Catalogacion1`.`Descripcion`', 9 => 10, 10 => '`Autoridades1`.`Nombre`', 11 => 12, 12 => 13, 13 => 14, 14 => '`Lugares1`.`Descripcion`', 15 => '`Editoriales1`.`Nombre`', 16 => 17, 17 => 18, 18 => 19, 19 => '`Materias1`.`Descriptor`', 20 => '`Materias2`.`Descriptor`', 21 => '`Materias3`.`Descriptor`', 22 => '`Catalogo`.`Ejemplares`', 23 => '`Catalogo`.`Fecha_Catalogacion`'],
					'records-per-page' => 10,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-Catalogo',
					'template-printable' => 'children-Catalogo-printable',
					'query' => "SELECT `Catalogo`.`id` as 'id', `Catalogo`.`Portada` as 'Portada', IF(    CHAR_LENGTH(`Registros1`.`Codigo_de_Registro`), CONCAT_WS('',   `Registros1`.`Codigo_de_Registro`), '') as 'Codigo_Registro', IF(    CHAR_LENGTH(`Registros1`.`Codigo_Barras`), CONCAT_WS('',   `Registros1`.`Codigo_Barras`), '') as 'Cod_Barras', `Catalogo`.`Item` as 'Item', `Catalogo`.`Cod_Ejemplar` as 'Cod_Ejemplar', `Catalogo`.`Tipo_Literatura` as 'Tipo_Literatura', IF(    CHAR_LENGTH(`Tipo_Documento1`.`Descripcion`), CONCAT_WS('',   `Tipo_Documento1`.`Descripcion`), '') as 'Tipo_Documento', IF(    CHAR_LENGTH(`Estado_Catalogacion1`.`Descripcion`), CONCAT_WS('',   `Estado_Catalogacion1`.`Descripcion`), '') as 'id_Estado_Catalogacion', `Catalogo`.`Signatura_Topografica` as 'Signatura_Topografica', IF(    CHAR_LENGTH(`Autoridades1`.`Nombre`), CONCAT_WS('',   `Autoridades1`.`Nombre`), '') as 'Id_Autoridad', `Catalogo`.`Titulo` as 'Titulo', `Catalogo`.`Responsabilidades` as 'Responsabilidades', `Catalogo`.`Edicion` as 'Edicion', IF(    CHAR_LENGTH(`Lugares1`.`Descripcion`), CONCAT_WS('',   `Lugares1`.`Descripcion`), '') as 'Id_Lugar', IF(    CHAR_LENGTH(`Editoriales1`.`Nombre`), CONCAT_WS('',   `Editoriales1`.`Nombre`), '') as 'id_Editorial', `Catalogo`.`Fecha_Publicacion` as 'Fecha_Publicacion', `Catalogo`.`Desc_Fisica` as 'Desc_Fisica', `Catalogo`.`Notas` as 'Notas', IF(    CHAR_LENGTH(`Materias1`.`Descriptor`), CONCAT_WS('',   `Materias1`.`Descriptor`), '') as 'Materia_1', IF(    CHAR_LENGTH(`Materias2`.`Descriptor`), CONCAT_WS('',   `Materias2`.`Descriptor`), '') as 'Materia_2', IF(    CHAR_LENGTH(`Materias3`.`Descriptor`), CONCAT_WS('',   `Materias3`.`Descriptor`), '') as 'Materia_3', `Catalogo`.`Ejemplares` as 'Ejemplares', if(`Catalogo`.`Fecha_Catalogacion`,date_format(`Catalogo`.`Fecha_Catalogacion`,'%m/%d/%Y'),'') as 'Fecha_Catalogacion' FROM `Catalogo` LEFT JOIN `Registros` as Registros1 ON `Registros1`.`id`=`Catalogo`.`Codigo_Registro` LEFT JOIN `Tipo_Documento` as Tipo_Documento1 ON `Tipo_Documento1`.`id`=`Catalogo`.`Tipo_Documento` LEFT JOIN `Estado_Catalogacion` as Estado_Catalogacion1 ON `Estado_Catalogacion1`.`id`=`Catalogo`.`id_Estado_Catalogacion` LEFT JOIN `Autoridades` as Autoridades1 ON `Autoridades1`.`id`=`Catalogo`.`Id_Autoridad` LEFT JOIN `Lugares` as Lugares1 ON `Lugares1`.`id`=`Catalogo`.`Id_Lugar` LEFT JOIN `Editoriales` as Editoriales1 ON `Editoriales1`.`id`=`Catalogo`.`id_Editorial` LEFT JOIN `Materias` as Materias1 ON `Materias1`.`id`=`Catalogo`.`Materia_1` LEFT JOIN `Materias` as Materias2 ON `Materias2`.`id`=`Catalogo`.`Materia_2` LEFT JOIN `Materias` as Materias3 ON `Materias3`.`id`=`Catalogo`.`Materia_3` "
				],
			],
			'Circulacion' => [
				'id_Usuario' => [
					'parent-table' => 'Usuarios',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Circulacion <span class="hidden child-label-Circulacion child-field-caption">(Usuario)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/arrow_refresh.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => [1 => 'Usuario', 2 => 'Foto Usuario', 3 => 'Tipo de Usuario', 4 => 'Politica de pretamo', 5 => 'Tipo de documento', 6 => 'Registro', 7 => 'Libro Prestado', 8 => 'Portada del Libro', 9 => 'Fecha de Prestamo', 10 => 'Fecha de Devoluci&#243;n', 11 => 'Estado de Prestamo', 12 => 'Cantidad', 13 => 'Ejemplares Disponibles', 14 => 'Item', 15 => 'Cod Ejemplar'],
					'display-field-names' => [1 => 'id_Usuario', 2 => 'Foto_Usuario', 3 => 'id_Tipo_usuario', 4 => 'id_Politica_pretamo', 5 => 'id_Tipo_documento', 6 => 'id_Registro', 7 => 'Libro_Prestado', 8 => 'Portada_libro', 9 => 'Fecha_Prestamo', 10 => 'Fecha_Devolucion', 11 => 'id_Estado_prestamo', 12 => 'Cantidad', 13 => 'Ejemp_Disponibles', 14 => 'Item', 15 => 'Cod_Ejemplar'],
					'sortable-fields' => [0 => '`Circulacion`.`id`', 1 => 2, 2 => '`Usuarios1`.`Foto`', 3 => '`Tipo_Usuario1`.`Descripcion`', 4 => 5, 5 => '`Tipo_Documento1`.`Descripcion`', 6 => 7, 7 => '`Catalogo1`.`Titulo`', 8 => '`Catalogo1`.`Portada`', 9 => '`Circulacion`.`Fecha_Prestamo`', 10 => '`Circulacion`.`Fecha_Devolucion`', 11 => '`Estado_Prestamo1`.`Descripcion`', 12 => '`Circulacion`.`Cantidad`', 13 => '`Catalogo1`.`Ejemplares`', 14 => '`Catalogo1`.`Item`', 15 => '`Itemes1`.`Cod_Ejemplar`'],
					'records-per-page' => 10,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-Circulacion',
					'template-printable' => 'children-Circulacion-printable',
					'query' => "SELECT `Circulacion`.`id` as 'id', IF(    CHAR_LENGTH(`Usuarios1`.`Apellidos`) || CHAR_LENGTH(`Usuarios1`.`Nombres`), CONCAT_WS('',   `Usuarios1`.`Apellidos`, ', ', `Usuarios1`.`Nombres`), '') as 'id_Usuario', IF(    CHAR_LENGTH(`Usuarios1`.`Foto`), CONCAT_WS('',   `Usuarios1`.`Foto`), '') as 'Foto_Usuario', IF(    CHAR_LENGTH(`Tipo_Usuario1`.`Descripcion`), CONCAT_WS('',   `Tipo_Usuario1`.`Descripcion`), '') as 'id_Tipo_usuario', IF(    CHAR_LENGTH(`Politica_de_Prestamos1`.`Duracion_Prestamo`) || CHAR_LENGTH(`Politica_de_Prestamos1`.`Lim_Doc_Presado`), CONCAT_WS('',   `Politica_de_Prestamos1`.`Duracion_Prestamo`, ' dias. L&#237;mite: ', `Politica_de_Prestamos1`.`Lim_Doc_Presado`), '') as 'id_Politica_pretamo', IF(    CHAR_LENGTH(`Tipo_Documento1`.`Descripcion`), CONCAT_WS('',   `Tipo_Documento1`.`Descripcion`), '') as 'id_Tipo_documento', IF(    CHAR_LENGTH(`Registros1`.`Codigo_de_Registro`), CONCAT_WS('',   `Registros1`.`Codigo_de_Registro`), '') as 'id_Registro', IF(    CHAR_LENGTH(`Catalogo1`.`Titulo`), CONCAT_WS('',   `Catalogo1`.`Titulo`), '') as 'Libro_Prestado', IF(    CHAR_LENGTH(`Catalogo1`.`Portada`), CONCAT_WS('',   `Catalogo1`.`Portada`), '') as 'Portada_libro', if(`Circulacion`.`Fecha_Prestamo`,date_format(`Circulacion`.`Fecha_Prestamo`,'%m/%d/%Y'),'') as 'Fecha_Prestamo', if(`Circulacion`.`Fecha_Devolucion`,date_format(`Circulacion`.`Fecha_Devolucion`,'%m/%d/%Y'),'') as 'Fecha_Devolucion', IF(    CHAR_LENGTH(`Estado_Prestamo1`.`Descripcion`), CONCAT_WS('',   `Estado_Prestamo1`.`Descripcion`), '') as 'id_Estado_prestamo', `Circulacion`.`Cantidad` as 'Cantidad', IF(    CHAR_LENGTH(`Catalogo1`.`Ejemplares`), CONCAT_WS('',   `Catalogo1`.`Ejemplares`), '') as 'Ejemp_Disponibles', IF(    CHAR_LENGTH(`Catalogo1`.`Item`), CONCAT_WS('',   `Catalogo1`.`Item`), '') as 'Item', IF(    CHAR_LENGTH(`Itemes1`.`Cod_Ejemplar`), CONCAT_WS('',   `Itemes1`.`Cod_Ejemplar`), '') as 'Cod_Ejemplar' FROM `Circulacion` LEFT JOIN `Usuarios` as Usuarios1 ON `Usuarios1`.`id`=`Circulacion`.`id_Usuario` LEFT JOIN `Tipo_Usuario` as Tipo_Usuario1 ON `Tipo_Usuario1`.`id`=`Circulacion`.`id_Tipo_usuario` LEFT JOIN `Politica_de_Prestamos` as Politica_de_Prestamos1 ON `Politica_de_Prestamos1`.`id`=`Circulacion`.`id_Politica_pretamo` LEFT JOIN `Tipo_Documento` as Tipo_Documento1 ON `Tipo_Documento1`.`id`=`Circulacion`.`id_Tipo_documento` LEFT JOIN `Catalogo` as Catalogo1 ON `Catalogo1`.`id`=`Circulacion`.`Libro_Prestado` LEFT JOIN `Estado_Prestamo` as Estado_Prestamo1 ON `Estado_Prestamo1`.`id`=`Circulacion`.`id_Estado_prestamo` LEFT JOIN `Itemes` as Itemes1 ON `Itemes1`.`id`=`Circulacion`.`Cod_Ejemplar` LEFT JOIN `Registros` as Registros1 ON `Registros1`.`id`=`Catalogo1`.`Codigo_Registro` "
				],
				'Libro_Prestado' => [
					'parent-table' => 'Catalogo',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Circulacion <span class="hidden child-label-Circulacion child-field-caption">(Libro Prestado)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/arrow_refresh.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => [1 => 'Usuario', 2 => 'Foto Usuario', 3 => 'Tipo de Usuario', 4 => 'Politica de pretamo', 5 => 'Tipo de documento', 6 => 'Registro', 7 => 'Libro Prestado', 8 => 'Portada del Libro', 9 => 'Fecha de Prestamo', 10 => 'Fecha de Devoluci&#243;n', 11 => 'Estado de Prestamo', 12 => 'Cantidad', 13 => 'Ejemplares Disponibles', 14 => 'Item', 15 => 'Cod Ejemplar'],
					'display-field-names' => [1 => 'id_Usuario', 2 => 'Foto_Usuario', 3 => 'id_Tipo_usuario', 4 => 'id_Politica_pretamo', 5 => 'id_Tipo_documento', 6 => 'id_Registro', 7 => 'Libro_Prestado', 8 => 'Portada_libro', 9 => 'Fecha_Prestamo', 10 => 'Fecha_Devolucion', 11 => 'id_Estado_prestamo', 12 => 'Cantidad', 13 => 'Ejemp_Disponibles', 14 => 'Item', 15 => 'Cod_Ejemplar'],
					'sortable-fields' => [0 => '`Circulacion`.`id`', 1 => 2, 2 => '`Usuarios1`.`Foto`', 3 => '`Tipo_Usuario1`.`Descripcion`', 4 => 5, 5 => '`Tipo_Documento1`.`Descripcion`', 6 => 7, 7 => '`Catalogo1`.`Titulo`', 8 => '`Catalogo1`.`Portada`', 9 => '`Circulacion`.`Fecha_Prestamo`', 10 => '`Circulacion`.`Fecha_Devolucion`', 11 => '`Estado_Prestamo1`.`Descripcion`', 12 => '`Circulacion`.`Cantidad`', 13 => '`Catalogo1`.`Ejemplares`', 14 => '`Catalogo1`.`Item`', 15 => '`Itemes1`.`Cod_Ejemplar`'],
					'records-per-page' => 10,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-Circulacion',
					'template-printable' => 'children-Circulacion-printable',
					'query' => "SELECT `Circulacion`.`id` as 'id', IF(    CHAR_LENGTH(`Usuarios1`.`Apellidos`) || CHAR_LENGTH(`Usuarios1`.`Nombres`), CONCAT_WS('',   `Usuarios1`.`Apellidos`, ', ', `Usuarios1`.`Nombres`), '') as 'id_Usuario', IF(    CHAR_LENGTH(`Usuarios1`.`Foto`), CONCAT_WS('',   `Usuarios1`.`Foto`), '') as 'Foto_Usuario', IF(    CHAR_LENGTH(`Tipo_Usuario1`.`Descripcion`), CONCAT_WS('',   `Tipo_Usuario1`.`Descripcion`), '') as 'id_Tipo_usuario', IF(    CHAR_LENGTH(`Politica_de_Prestamos1`.`Duracion_Prestamo`) || CHAR_LENGTH(`Politica_de_Prestamos1`.`Lim_Doc_Presado`), CONCAT_WS('',   `Politica_de_Prestamos1`.`Duracion_Prestamo`, ' dias. L&#237;mite: ', `Politica_de_Prestamos1`.`Lim_Doc_Presado`), '') as 'id_Politica_pretamo', IF(    CHAR_LENGTH(`Tipo_Documento1`.`Descripcion`), CONCAT_WS('',   `Tipo_Documento1`.`Descripcion`), '') as 'id_Tipo_documento', IF(    CHAR_LENGTH(`Registros1`.`Codigo_de_Registro`), CONCAT_WS('',   `Registros1`.`Codigo_de_Registro`), '') as 'id_Registro', IF(    CHAR_LENGTH(`Catalogo1`.`Titulo`), CONCAT_WS('',   `Catalogo1`.`Titulo`), '') as 'Libro_Prestado', IF(    CHAR_LENGTH(`Catalogo1`.`Portada`), CONCAT_WS('',   `Catalogo1`.`Portada`), '') as 'Portada_libro', if(`Circulacion`.`Fecha_Prestamo`,date_format(`Circulacion`.`Fecha_Prestamo`,'%m/%d/%Y'),'') as 'Fecha_Prestamo', if(`Circulacion`.`Fecha_Devolucion`,date_format(`Circulacion`.`Fecha_Devolucion`,'%m/%d/%Y'),'') as 'Fecha_Devolucion', IF(    CHAR_LENGTH(`Estado_Prestamo1`.`Descripcion`), CONCAT_WS('',   `Estado_Prestamo1`.`Descripcion`), '') as 'id_Estado_prestamo', `Circulacion`.`Cantidad` as 'Cantidad', IF(    CHAR_LENGTH(`Catalogo1`.`Ejemplares`), CONCAT_WS('',   `Catalogo1`.`Ejemplares`), '') as 'Ejemp_Disponibles', IF(    CHAR_LENGTH(`Catalogo1`.`Item`), CONCAT_WS('',   `Catalogo1`.`Item`), '') as 'Item', IF(    CHAR_LENGTH(`Itemes1`.`Cod_Ejemplar`), CONCAT_WS('',   `Itemes1`.`Cod_Ejemplar`), '') as 'Cod_Ejemplar' FROM `Circulacion` LEFT JOIN `Usuarios` as Usuarios1 ON `Usuarios1`.`id`=`Circulacion`.`id_Usuario` LEFT JOIN `Tipo_Usuario` as Tipo_Usuario1 ON `Tipo_Usuario1`.`id`=`Circulacion`.`id_Tipo_usuario` LEFT JOIN `Politica_de_Prestamos` as Politica_de_Prestamos1 ON `Politica_de_Prestamos1`.`id`=`Circulacion`.`id_Politica_pretamo` LEFT JOIN `Tipo_Documento` as Tipo_Documento1 ON `Tipo_Documento1`.`id`=`Circulacion`.`id_Tipo_documento` LEFT JOIN `Catalogo` as Catalogo1 ON `Catalogo1`.`id`=`Circulacion`.`Libro_Prestado` LEFT JOIN `Estado_Prestamo` as Estado_Prestamo1 ON `Estado_Prestamo1`.`id`=`Circulacion`.`id_Estado_prestamo` LEFT JOIN `Itemes` as Itemes1 ON `Itemes1`.`id`=`Circulacion`.`Cod_Ejemplar` LEFT JOIN `Registros` as Registros1 ON `Registros1`.`id`=`Catalogo1`.`Codigo_Registro` "
				],
			],
			'Tipo_Documento' => [
			],
			'Autoridades' => [
				'id_Tipo_autoridad' => [
					'parent-table' => 'Tipo_Autoridad',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Autoridades <span class="hidden child-label-Autoridades child-field-caption">(Id Tipo autoridad)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/administrator.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => [1 => 'Foto', 2 => 'Id Tipo autoridad', 3 => 'Nombre', 4 => 'Fecha Extrema', 5 => 'Vease Ademas'],
					'display-field-names' => [1 => 'Foto', 2 => 'id_Tipo_autoridad', 3 => 'Nombre', 4 => 'Fecha_Extrema', 5 => 'Vease_Ademas'],
					'sortable-fields' => [0 => '`Autoridades`.`id`', 1 => 2, 2 => '`Tipo_Autoridad1`.`Descripcion`', 3 => 4, 4 => 5, 5 => 6],
					'records-per-page' => 10,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-Autoridades',
					'template-printable' => 'children-Autoridades-printable',
					'query' => "SELECT `Autoridades`.`id` as 'id', `Autoridades`.`Foto` as 'Foto', IF(    CHAR_LENGTH(`Tipo_Autoridad1`.`Descripcion`), CONCAT_WS('',   `Tipo_Autoridad1`.`Descripcion`), '') as 'id_Tipo_autoridad', `Autoridades`.`Nombre` as 'Nombre', `Autoridades`.`Fecha_Extrema` as 'Fecha_Extrema', `Autoridades`.`Vease_Ademas` as 'Vease_Ademas' FROM `Autoridades` LEFT JOIN `Tipo_Autoridad` as Tipo_Autoridad1 ON `Tipo_Autoridad1`.`id`=`Autoridades`.`id_Tipo_autoridad` "
				],
			],
			'Estado_Suscripcion' => [
			],
			'Usuarios' => [
			],
			'Politica_de_Prestamos' => [
			],
			'Lugares' => [
			],
			'Tipo_Autoridad' => [
			],
			'Tipo_Usuario' => [
			],
			'Materias' => [
			],
			'Itemes' => [
				'Cod_item' => [
					'parent-table' => 'Catalogo',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Itemes <span class="hidden child-label-Itemes child-field-caption">(Cod item)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/book_add.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => [1 => 'Cod item', 2 => 'Estado Conservacion', 3 => 'Num Copia', 4 => 'Cod Ejemplar', 5 => 'Estado de Baja'],
					'display-field-names' => [1 => 'Cod_item', 2 => 'Estado_Conservacion', 3 => 'Num_Copia', 4 => 'Cod_Ejemplar', 5 => 'Estado_de_Baja'],
					'sortable-fields' => [0 => '`Itemes`.`id`', 1 => '`Catalogo1`.`Item`', 2 => '`Estado_Conservacion1`.`Descripcion`', 3 => 4, 4 => 5, 5 => 6],
					'records-per-page' => 10,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-Itemes',
					'template-printable' => 'children-Itemes-printable',
					'query' => "SELECT `Itemes`.`id` as 'id', IF(    CHAR_LENGTH(`Catalogo1`.`Item`), CONCAT_WS('',   `Catalogo1`.`Item`), '') as 'Cod_item', IF(    CHAR_LENGTH(`Estado_Conservacion1`.`Descripcion`), CONCAT_WS('',   `Estado_Conservacion1`.`Descripcion`), '') as 'Estado_Conservacion', `Itemes`.`Num_Copia` as 'Num_Copia', `Itemes`.`Cod_Ejemplar` as 'Cod_Ejemplar', `Itemes`.`Estado_de_Baja` as 'Estado_de_Baja' FROM `Itemes` LEFT JOIN `Catalogo` as Catalogo1 ON `Catalogo1`.`id`=`Itemes`.`Cod_item` LEFT JOIN `Estado_Conservacion` as Estado_Conservacion1 ON `Estado_Conservacion1`.`id`=`Itemes`.`Estado_Conservacion` "
				],
			],
		];

	/*************************************/
	/* End of configuration */


	include_once(__DIR__ . '/lib.php');
	@header('Content-Type: text/html; charset=' . datalist_db_encoding);

	handle_maintenance();

	/**
	* dynamic configuration based on current user's permissions
	* $userPCConfig array is populated only with parent tables where the user has access to
	* at least one child table
	*/
	$userPCConfig = [];
	foreach($pcConfig as $pcChildTable => $ChildrenLookups) {
		$permChild = getTablePermissions($pcChildTable);
		if(!$permChild['view']) continue;

		foreach($ChildrenLookups as $ChildLookupField => $ChildConfig) {
			$permParent = getTablePermissions($ChildConfig['parent-table']);
			if(!$permParent['view']) continue;

			$userPCConfig[$pcChildTable][$ChildLookupField] = $pcConfig[$pcChildTable][$ChildLookupField];
			// show add new only if configured above AND the user has insert permission
			$userPCConfig[$pcChildTable][$ChildLookupField]['display-add-new'] = ($permChild['insert'] && $pcConfig[$pcChildTable][$ChildLookupField]['display-add-new']);
		}
	}

	/* Receive, UTF-convert, and validate parameters */
	$ParentTable = Request::val('ParentTable'); // needed only with operation=show-children, will be validated in the processing code
	$ChildTable = Request::val('ChildTable');
		if(!in_array($ChildTable, array_keys($userPCConfig))) {
			/* defaults to first child table in config array if not provided */
			$ChildTable = current(array_keys($userPCConfig));
		}
		if(!$ChildTable) { die('<!-- No tables accessible to current user -->'); }
	$SelectedID = strip_tags(Request::val('SelectedID'));
	$ChildLookupField = Request::val('ChildLookupField');
		if(!in_array($ChildLookupField, array_keys($userPCConfig[$ChildTable]))) {
			/* defaults to first lookup in current child config array if not provided */
			$ChildLookupField = current(array_keys($userPCConfig[$ChildTable]));
		}

	if(function_exists('child_records_config')) {
		// $userPCConfig is passed by reference
		child_records_config($ChildTable, $ChildLookupField, $userPCConfig);
	}

	$currentConfig = $userPCConfig[$ChildTable][$ChildLookupField];
	if(empty($currentConfig))
		die('<!-- No tables accessible to current user -->');

	$Page = intval(Request::val('Page'));
		if($Page < 1) $Page = 1;
	$SortBy = (Request::val('SortBy') != '' ? abs(intval(Request::val('SortBy'))) : false);
		if(!in_array($SortBy, array_keys($currentConfig['sortable-fields']), true))
			$SortBy = $currentConfig['default-sort-by'];
	$SortDirection = strtolower(Request::val('SortDirection'));
		if(!in_array($SortDirection, ['asc', 'desc']))
			$SortDirection = $currentConfig['default-sort-direction'];
	$Operation = strtolower(Request::val('Operation'));
		if(!in_array($Operation, ['get-records', 'show-children', 'get-records-printable', 'show-children-printable']))
			$Operation = 'get-records';

	/* process requested operation */
	switch($Operation) {
		/************************************************/
		case 'show-children':
			/* populate HTML and JS content with children tabs */
			$tabLabels = $tabPanels = $tabLoaders = '';
			foreach($userPCConfig as $ChildTable => $childLookups) {
				foreach($childLookups as $ChildLookupField => $childConfig) {
					if($childConfig['parent-table'] != $ParentTable) continue;

					$TableIcon = ($childConfig['table-icon'] ? "<img src=\"{$childConfig['table-icon']}\" border=\"0\">" : '');

					$tabLabels .= "<li class=\"child-tab-label child-table-{$ChildTable} lookup-field-{$ChildLookupField} " . ($tabLabels ? '' : 'active') . "\">" .
							"<a href=\"#panel_{$ChildTable}-{$ChildLookupField}\" id=\"tab_{$ChildTable}-{$ChildLookupField}\" data-toggle=\"tab\">" .
								$TableIcon . $childConfig['tab-label'] .
								"<span class=\"badge child-count child-count-{$ChildTable}-{$ChildLookupField}\"></span>" .
							"</a>" .
						"</li>\n\t\t\t\t";

					$tabPanels .= "<div id=\"panel_{$ChildTable}-{$ChildLookupField}\" class=\"tab-pane" . ($tabPanels ? '' : ' active') . "\">" .
							"<i class=\"glyphicon glyphicon-refresh loop-rotate\"></i> " .
							"{$Translation['Loading ...']}" .
						"</div>\n\t\t\t\t";

					$tabLoaders .= "post('parent-children.php', " . json_encode([
							'ChildTable' => $ChildTable,
							'ChildLookupField' => $ChildLookupField,
							'SelectedID' => $SelectedID,
							'Page' => 1,
							'SortBy' => '',
							'SortDirection' => '',
							'Operation' => 'get-records'
						]) . ", 'panel_{$ChildTable}-{$ChildLookupField}');\n\t\t\t\t";
				}
			}

			if(!$tabLabels) { die('<!-- no children of current parent table are accessible to current user -->'); }
			?>
			<div id="children-tabs">
				<ul class="nav nav-tabs">
					<?php echo $tabLabels; ?>
				</ul>
				<span id="pc-loading"></span>
			</div>
			<div class="tab-content"><?php echo $tabPanels; ?></div>

			<script>
				$j(function() {
					/* for iOS, avoid loading child tabs in modals */
					var iOS = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
					var embedded = ($j('.navbar').length == 0);
					if(iOS && embedded) {
						$j('#children-tabs').next('.tab-content').remove();
						$j('#children-tabs').remove();
						return;
					}

					/* ajax loading of each tab's contents */
					<?php echo $tabLoaders; ?>

					/* show child field caption on tab title in case the same child table appears more than once */
					$j('.child-field-caption').each(function() {
						var clss = $j(this).attr('class').split(/\s+/).reduce(function(rc, cc) {
							return (cc.match(/child-label-.*/) ? '.' + cc : rc);
						}, '');

						// if class occurs more than once, remove .hidden
						if($j(clss).length > 1) $j(clss).removeClass('hidden');
					})
				})
			</script>
			<?php
			break;

		/************************************************/
		case 'show-children-printable':
			/* populate HTML and JS content with children buttons */
			$tabLabels = $tabPanels = $tabLoaders = '';
			foreach($userPCConfig as $ChildTable => $childLookups) {
				foreach($childLookups as $ChildLookupField => $childConfig) {
					if($childConfig['parent-table'] != $ParentTable) continue;

					$TableIcon = ($childConfig['table-icon'] ? "<img src=\"{$childConfig['table-icon']}\" border=\"0\">" : '');

					$tabLabels .= "<button type=\"button\" class=\"btn btn-default child-tab-print-toggler\" data-target=\"#panel_{$ChildTable}-{$ChildLookupField}\" id=\"tab_{$ChildTable}-{$ChildLookupField}\" data-toggle=\"collapse\">" .
							"{$TableIcon} {$childConfig['tab-label']}" .
							"<span class=\"badge child-count child-count-{$ChildTable}-{$ChildLookupField}\"></span>" .
						"</button>\n\t\t\t\t\t";

					$tabPanels .= "<div id=\"panel_{$ChildTable}-{$ChildLookupField}\" class=\"collapse child-panel-print\">" .
							"<i class=\"glyphicon glyphicon-refresh loop-rotate\"></i> " .
							$Translation['Loading ...'] .
						"</div>\n\t\t\t\t";

					$tabLoaders .= "post('parent-children.php', " . json_encode([
							'ChildTable' => $ChildTable,
							'ChildLookupField' => $ChildLookupField,
							'SelectedID' => $SelectedID,
							'Page' => 1,
							'SortBy' => '',
							'SortDirection' => '',
							'Operation' => 'get-records-printable'
						]) . ", 'panel_{$ChildTable}-{$ChildLookupField}');\n\t\t\t\t";
				}
			}

			if(!$tabLabels) { die('<!-- no children of current parent table are accessible to current user -->'); }
			?>
			<div id="children-tabs" class="hidden-print">
				<div class="btn-group btn-group-lg">
					<?php echo $tabLabels; ?>
				</div>
				<span id="pc-loading"></span>
			</div>
			<div class="vspacer-lg"><?php echo $tabPanels; ?></div>

			<script>
				$j(function() {
					/* for iOS, avoid loading child tabs in modals */
					var iOS = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
					var embedded = ($j('.navbar').length == 0);
					if(iOS && embedded) {
						$j('#children-tabs').next('.tab-content').remove();
						$j('#children-tabs').remove();
						return;
					}

					/* ajax loading of each tab's contents */
					<?php echo $tabLoaders; ?>
				})
			</script>
			<?php
			break;

		/************************************************/
		case 'get-records-printable':
		default: /* default is 'get-records' */

			if($Operation == 'get-records-printable') {
				$currentConfig['records-per-page'] = 2000;
			}

			// build the user permissions limiter
			$permissionsWhere = $permissionsJoin = '';
			$permChild = getTablePermissions($ChildTable);
			if($permChild['view'] == 1) { // user can view only his own records
				$permissionsWhere = "`$ChildTable`.`{$currentConfig['child-primary-key']}`=`membership_userrecords`.`pkValue` AND `membership_userrecords`.`tableName`='$ChildTable' AND LCASE(`membership_userrecords`.`memberID`)='" . getLoggedMemberID() . "'";
			} elseif($permChild['view'] == 2) { // user can view only his group's records
				$permissionsWhere = "`$ChildTable`.`{$currentConfig['child-primary-key']}`=`membership_userrecords`.`pkValue` AND `membership_userrecords`.`tableName`='$ChildTable' AND `membership_userrecords`.`groupID`='" . getLoggedGroupID() . "'";
			} elseif($permChild['view'] == 3) { // user can view all records
				/* that's the only case remaining ... no need to modify the query in this case */
			}
			$permissionsJoin = ($permissionsWhere ? ", `membership_userrecords`" : '');

			// build the count query
			$forcedWhere = $currentConfig['forced-where'];
			$query = 
				preg_replace('/^select .* from /i', 'SELECT count(1) FROM ', $currentConfig['query']) .
				$permissionsJoin . " WHERE " .
				($permissionsWhere ? "( $permissionsWhere )" : "( 1=1 )") . " AND " .
				($forcedWhere ? "( $forcedWhere )" : "( 2=2 )") . " AND " .
				"`$ChildTable`.`$ChildLookupField`='" . makeSafe($SelectedID) . "'";
			$totalMatches = sqlValue($query);

			// make sure $Page is <= max pages
			$maxPage = ceil($totalMatches / $currentConfig['records-per-page']);
			if($Page > $maxPage) { $Page = $maxPage; }

			// initiate output data array
			$data = [
				'config' => $currentConfig,
				'parameters' => [
					'ChildTable' => $ChildTable,
					'ChildLookupField' => $ChildLookupField,
					'SelectedID' => $SelectedID,
					'Page' => $Page,
					'SortBy' => $SortBy,
					'SortDirection' => $SortDirection,
					'Operation' => $Operation,
				],
				'records' => [],
				'totalMatches' => $totalMatches
			];

			// build the data query
			if($totalMatches) { // if we have at least one record, proceed with fetching data
				$startRecord = $currentConfig['records-per-page'] * ($Page - 1);
				$data['query'] = 
					$currentConfig['query'] .
					$permissionsJoin . " WHERE " .
					($permissionsWhere ? "( $permissionsWhere )" : "( 1=1 )") . " AND " .
					($forcedWhere ? "( $forcedWhere )" : "( 2=2 )") . " AND " .
					"`$ChildTable`.`$ChildLookupField`='" . makeSafe($SelectedID) . "'" . 
					($SortBy !== false && $currentConfig['sortable-fields'][$SortBy] ? " ORDER BY {$currentConfig['sortable-fields'][$SortBy]} $SortDirection" : '') .
					" LIMIT $startRecord, {$currentConfig['records-per-page']}";
				$res = sql($data['query'], $eo);
				while($row = db_fetch_row($res)) {
					$data['records'][$row[$currentConfig['child-primary-key-index']]] = $row;
				}
			} else { // if no matching records
				$startRecord = 0;
			}

			if($Operation == 'get-records-printable') {
				$response = loadView($currentConfig['template-printable'], $data);
			} else {
				$response = loadView($currentConfig['template'], $data);
			}

			// change name space to ensure uniqueness
			$uniqueNameSpace = $ChildTable.ucfirst($ChildLookupField).'GetRecords';
			echo str_replace("{$ChildTable}GetChildrenRecordsList", $uniqueNameSpace, $response);
		/************************************************/
	}
